<div class="container-fluid" id="workspace-elements" ng-controller="WorkspaceElementsCtrl">

    <div class="row">

        <div class="col-md-9" ng-click="checkSelection($event)">
            <h4>Browsing '{{wsName}}' workspace elements</h4>
            <ol class="breadcrumb" >
                <li><a href="#/workspaces/{{wsName}}/head///browse">root</a></li>
                <li ng-repeat="part in breadcrumbParts">
                    <a href="#/workspaces/{{wsName}}/head/{{part}}/browse">{{element.pathParts[$index]}}</a>
                </li>
            </ol>
            <div id="browsing-panel" class="panel panel-default">
                <!--Body content-->

                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-4">
                            <input ng-model="query" class="form-control" placeholder="Search">
                        </div>
                        <div class="col-md-7 col-md-offset-1">
                            <div class="btn-toolbar text-right" role="toolbar">
                                <div ng-if="!selectedChild">
                                    <a ng-if="element.stream" class="btn  btn-primary" href="{{urlBase}}/rest/workspaces/{{wsName}}/download?path={{element.path}}"><i class="glyphicon glyphicon-download"></i>Download</a>
                                </div>
                                <span ng-if="selectedChild">
                                    <a ng-if="selectedChildData.object.stream" class="btn  btn-primary" href="{{selectedChildData.object.downloadUrl}}"><i class="glyphicon glyphicon-download"></i> Download</a>
                                    <button class="btn btn-danger" ng-click="clickDelete()"><i class="glyphicon glyphicon-trash"></i> Delete</button>
                                </span>

                                <div class="dropdown-wrapper">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                        <span class="glyphicon glyphicon-sort"></span> Sort by
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                        <li><div ng-click="order('name', false)">Name</div></li>
                                        <li><div ng-click="order(['type','name'], false)">Type</div></li>
                                        <li><div ng-click="order('modification', false)">Date</div></li>
                                    </ul>
                                </div>

                                <button class="btn btn-default" ng-click="newCollectionModal()"><i class="glyphicon glyphicon-plus"></i>  New collection</button>
                            </div>
                        </div>
                    </div>
                </div>

                <table ng-if="element.elements" class="table table-hover workspace-elements">
                    <thead>
                    <tr>
                        <th ng-click="order('name', 'toggle')">Name</th>
                        <th ng-click="order('modification', 'toggle')">Modification Date</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="element-child" ng-repeat="child in element.elements | filter:filterChildren(query) | orderBy:orderProp:orderReverse" ng-click="clickChild($event, child)" ng-right-click="clickChild($event, child)" ng-class="{info : isSelected(child)}">
                        <td><span class="{{child.type | elementIconCss}}"></span> <a href="#/workspaces/{{wsName}}/head/{{element.path}}/{{child.name}}/browse">{{child.name}}</a></td>
                        <td>{{child.modification | date : dateFormat}}</td>
                    </tr>
                    </tbody>
                </table>
                <div ng-show="contextMenu && menuItems" ng-style="contextMenuStyle" id="contextMenu" class="dropdown clearfix open">
                    <ul class="dropdown-menu" role="menu">
                        <li ng-repeat="item in menuItems" class="{{item.divider ? 'divider' : ''}}">
                            <a ng-if="item.href" tabindex="-1" href="{{item.href}}"><i class="{{item.icon | iconFullClass}}"></i> {{item.text}}</a>
                            <div ng-if="!item.href && item.action === 'delete'" ng-click="clickDelete()" tabindex="-1"><i class="{{item.icon | iconFullClass}}"></i> {{item.text}}</div>
                            <div ng-if="!item.href && item.action === 'newCollection'" ng-click="newCollectionModal()" tabindex="-1"><i class="{{item.icon | iconFullClass}}"></i> {{item.text}}</div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <!--Sidebar content-->

            <h4 ng-if="!selectedChild"><span class="{{element.type | elementIconCss}}"></span> {{element.name}}</h4>
            <h4 ng-if="selectedChild"><span class="{{selectedChild.type | elementIconCss}}"></span> {{selectedChildData.object.name}}</h4>

            <ul id="sideTabs" class="nav nav-tabs nav-justified" role="tablist">
                <li class="active"><a href="#information" role="tab" ng-click="toggleTab($event)">Information</a></li>
                <li><a href="#metadata" role="tab" ng-click="toggleTab($event)">Metadata</a></li>
            </ul>

            <div class="tab-content">
                <div class="tab-pane active" id="information">
                    <dl ng-if="!selectedChild">
                        <dt>Name</dt>
                        <dd>{{element.name}}</dd>
                        <dt>Description</dt>
                        <dd>{{element.description}}</dd>
                        <dt>Type</dt>
                        <dd>{{element.type}}</dd>
                        <dt>Clock</dt>
                        <dd>{{element.clock}}</dd>
                        <dt>Size</dt>
                        <dd>{{element.elements.length}} element{{element.elements.length > 1 ? 's' : ''}}</dd>
                    </dl>

                    <dl ng-if="selectedChild">
                        <dt>Name</dt>
                        <dd>{{selectedChildData.object.name}}</dd>
                        <dt>Description</dt>
                        <dd>{{selectedChildData.object.description}}</dd>
                        <dt>Content type</dt>
                        <dd>{{selectedChildData.object.contentType | contentType}}</dd>
                        <dt>Author</dt>
                        <dd>{{selectedChildData.author}}</dd>
                        <dt>Created</dt>
                        <dd>{{selectedChildData.creationDate | date : 'medium'}}</dd>
                        <dt>Modified</dt>
                        <dd>{{selectedChildData.lastModificationDate | date : 'medium'}}</dd>
                        <dt>Clock</dt>
                        <dd>{{element.clock}}</dd>
                        <div ng-if="selectedChildData.object.size">
                            <dt>Size</dt>
                            <dd>{{selectedChildData.object.size | bytes}}</dd>
                        </div>

                    </dl>
                </div>
                <div class="tab-pane" id="metadata">
                    <div class="list-group">
                        <div ng-if="!selectedChild">
                            <a ng-repeat="metadata in element.metadatas" ng-click="loadMetadata($event, metadata)" class="list-group-item metadata-{{metadata.key}}" href="#">{{metadata.name}}</a>
                        </div>
                        <div ng-if="selectedChild">
                            <a ng-repeat="metadata in selectedChildData.object.metadatas" ng-click="loadMetadata($event, metadata)" class="list-group-item">{{metadata.name}}</a>
                        </div>
                    </div>
                    <div ng-include="'partials/metadataUpload.html'"></div>
                </div>
            </div>
        </div>

        <div class="col-md-12" ng-if="code" hljs source="code"></div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="newCollectionModal" tabindex="-1" role="dialog" aria-labelledby="newCollectionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title" id="newCollectionModalLabel">New collection</h4>
                </div>
                <div class="modal-body">
                    <form class="form-horizontal" role="form">
                        <div class="form-group">
                            <label for="newCollectionName" class="col-sm-2 control-label">Name</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="newCollectionName" placeholder="Name" ng-model="newCollectionName">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="newCollectionDescription" class="col-sm-2 control-label">Description</label>
                            <div class="col-sm-10">
                                <textarea id="newCollectionDescription" class="form-control" rows="3" placeholder="Description (optional)" ng-model="newCollectionDescription"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" ng-click="addCollection()">Add</button>
                </div>
            </div>
        </div>
    </div>
</div>